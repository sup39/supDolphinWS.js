!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(n="undefined"!=typeof globalThis?globalThis:n||self).Dolphin=e()}(this,(function(){"use strict";function n(n,e,t,r){return new(t||(t=Promise))((function(o,i){function u(n){try{a(r.next(n))}catch(n){i(n)}}function c(n){try{a(r.throw(n))}catch(n){i(n)}}function a(n){var e;n.done?o(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(u,c)}a((r=r.apply(n,e||[])).next())}))}function e(n,e){var t,r,o,i,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(a){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(u=0)),u;)try{if(t=1,r&&(o=2&c[0]?r.return:c[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,c[1])).done)return o;switch(r=0,o&&(c=[2&c[0],o.value]),c[0]){case 0:case 1:o=c;break;case 4:return u.label++,{value:c[1],done:!1};case 5:u.label++,r=c[1],c=[0];continue;case 7:c=u.ops.pop(),u.trys.pop();continue;default:if(!(o=u.trys,(o=o.length>0&&o[o.length-1])||6!==c[0]&&2!==c[0])){u=0;continue}if(3===c[0]&&(!o||c[1]>o[0]&&c[1]<o[3])){u.label=c[1];break}if(6===c[0]&&u.label<o[1]){u.label=o[1],o=c;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(c);break}o[2]&&u.ops.pop(),u.trys.pop();continue}c=e.call(n,u)}catch(n){c=[6,n],r=0}finally{t=o=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,a])}}}var t=function(n){return"number"==typeof n?[n]:n};return function(r,o){return void 0===r&&(r="ws://localhost:35353"),void 0===o&&(o=0),n(this,void 0,void 0,(function(){var i,u,c,a,f;return e(this,(function(s){switch(s.label){case 0:return u=1,c=new Map,a=function(){return new Promise((function(n,e){(i=new WebSocket(r)).binaryType="arraybuffer",i.onopen=function(){console.log("Connected to ".concat(r)),n(i)},i.onerror=function(n){console.error(n),e(n)},i.onclose=o>0?function(){console.warn("Connection closed. Try to reconnect after ".concat(o,"ms")),setTimeout(a,o)}:function(){return console.warn("Connection closed")},i.onmessage=function(n){var e=n.data;if("string"!=typeof e&&!(e.length<5)){var t=new DataView(e),r=t.getUint32(0),o=c.get(r);if(null!=o){c.delete(r);var i=o[0],u=o[1],a=t.getUint8(4),f=e.slice(5);a?u({code:a,body:(new TextDecoder).decode(f)}):i(f)}}}}))},f=function(n,e){return new Promise((function(t,r){var o,a=u++,f=new ArrayBuffer(5+(null!==(o=null==e?void 0:e.byteLength)&&void 0!==o?o:0)),s=new DataView(f);s.setUint32(0,a),s.setUint8(4,n),e&&new Uint8Array(f).set(new Uint8Array(e),5),c.set(a,[t,r]),i.send(f)}))},[4,a()];case 1:return s.sent(),[2,{connect:a,get ws(){return i},getVersion:function(){return n(this,void 0,void 0,(function(){var n;return e(this,(function(e){switch(e.label){case 0:return[4,f(0)];case 1:return n=e.sent(),[2,(new TextDecoder).decode(n)]}}))}))},hook:function(){return n(this,void 0,void 0,(function(){return e(this,(function(n){switch(n.label){case 0:return[4,f(1)];case 1:return n.sent(),[2]}}))}))},readRAM:function(r,o){return n(this,void 0,void 0,(function(){var n,i,u;return e(this,(function(e){switch(e.label){case 0:return n=t(r),(i=new DataView(new ArrayBuffer(4+4*n.length))).setUint32(0,o),n.forEach((function(n,e){return i.setUint32(4+4*e,n)})),[4,f(2,i.buffer)];case 1:return u=e.sent(),[2,new DataView(u)]}}))}))},writeRAM:function(r,o){var i;return n(this,void 0,void 0,(function(){var n,u,c,a,s,l;return e(this,(function(e){switch(e.label){case 0:return n=t(r),u="string"==typeof o?new Uint8Array((null!==(i=o.match(/[\da-f]{2}/gi))&&void 0!==i?i:[]).map((function(n){return parseInt(n,16)}))):o,c=u.byteLength,(a=new DataView(new ArrayBuffer(4+c+4*n.length))).setUint32(0,c),new Uint8Array(a.buffer).set(new Uint8Array(u),4),s=4+c,n.forEach((function(n,e){return a.setUint32(s+4*e,n)})),[4,f(3,a.buffer)];case 1:return l=e.sent(),[2,new DataView(l)]}}))}))}}]}}))}))}}));
